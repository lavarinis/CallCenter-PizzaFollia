{"version":3,"sources":["createSharedElementScene.tsx"],"names":["React","View","StyleSheet","hoistNonReactStatics","nodeFromRef","SharedElementSceneData","SharedElementSceneContext","getActiveRouteState","styles","create","container","flex","createSharedElementScene","Component","rendererData","SharedElementSceneView","subscriptions","sceneData","props","navigation","onSetRef","ref","setAncestor","onWillFocus","activeRoute","state","routeName","willActivateScene","onDidFocus","didActivateScene","willFocus","addListener","didFocus","Object","values","forEach","subscription","remove","PureComponent"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { View, StyleSheet } from 'react-native';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport { nodeFromRef } from 'react-native-shared-element';\nimport SharedElementSceneData from './SharedElementSceneData';\nimport SharedElementSceneContext from './SharedElementSceneContext';\nimport {\n  SharedElementEventSubscription,\n  NavigationProp,\n  SharedElementSceneComponent,\n} from './types';\nimport { ISharedElementRendererData } from './SharedElementRendererData';\nimport { getActiveRouteState } from './utils';\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n});\n\ntype PropsType = {\n  navigation: NavigationProp;\n};\n\nfunction createSharedElementScene(\n  Component: SharedElementSceneComponent,\n  rendererData: ISharedElementRendererData\n): React.ComponentType<any> {\n  class SharedElementSceneView extends React.PureComponent<PropsType> {\n    private subscriptions: {\n      [key: string]: SharedElementEventSubscription;\n    } = {};\n    private sceneData: SharedElementSceneData = new SharedElementSceneData(\n      Component,\n      this.props.navigation\n    );\n\n    componentDidMount() {\n      const { navigation } = this.props;\n      this.subscriptions = {\n        willFocus: navigation.addListener('willFocus', this.onWillFocus),\n        didFocus: navigation.addListener('didFocus', this.onDidFocus),\n      };\n    }\n\n    componentWillUnmount() {\n      Object.values(this.subscriptions).forEach(subscription =>\n        subscription.remove()\n      );\n    }\n\n    render() {\n      // console.log('SharedElementSceneView.render');\n      return (\n        <SharedElementSceneContext.Provider value={this.sceneData}>\n          <View\n            style={styles.container}\n            collapsable={false}\n            ref={this.onSetRef}\n          >\n            <Component {...this.props} />\n          </View>\n        </SharedElementSceneContext.Provider>\n      );\n    }\n\n    componentDidUpdate() {\n      this.sceneData.navigation = this.props.navigation;\n    }\n\n    private onSetRef = (ref: any) => {\n      this.sceneData.setAncestor(nodeFromRef(ref));\n    };\n\n    private onWillFocus = () => {\n      const { navigation } = this.props;\n      const activeRoute = getActiveRouteState(navigation.state);\n      if (navigation.state.routeName === activeRoute.routeName) {\n        // console.log('onWillFocus: ', navigation.state, activeRoute);\n        rendererData.willActivateScene(this.sceneData, navigation.state);\n      }\n    };\n\n    private onDidFocus = () => {\n      const { navigation } = this.props;\n      const activeRoute = getActiveRouteState(navigation.state);\n      if (navigation.state.routeName === activeRoute.routeName) {\n        // console.log('onDidFocus: ', this.sceneData.name, navigation);\n        rendererData.didActivateScene(this.sceneData, navigation.state);\n      }\n    };\n  }\n\n  hoistNonReactStatics(SharedElementSceneView, Component);\n  return SharedElementSceneView;\n}\n\nexport default createSharedElementScene;\n"]}